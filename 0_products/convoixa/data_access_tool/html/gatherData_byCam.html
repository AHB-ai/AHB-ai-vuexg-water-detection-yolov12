
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Retrieve Data by Camera Group</title><meta name="generator" content="MATLAB 8.3"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2016-02-09"><meta name="DC.source" content="gatherData_byCam.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Retrieve Data by Camera Group</h1><!--introduction--><p>This script is to gather data based on the camera groups and dates, and then convert the data to matlab data structure (new_data). In the mean time, it keeps the information of how the data stores in the matlab data structure (dateMap) in order to quick access in a later stage.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">I/O</a></li><li><a href="#2">Code</a></li><li><a href="#5">Navigation</a></li><li><a href="#6">Author</a></li></ul></div><h2>I/O<a name="1"></a></h2><div><ul><li>INPUT:</li></ul></div><p>
<table border=2>
<tr><td><b>date</b></td><td>the request date for conversion</td></tr>
<tr><td><b>output_folder</b></td><td>the path to store the converted ANPR data, and intermediate data</td></tr>
<tr><td><b>camList</b></td><td>is used to organise data by camera group</td></tr>
</table>
</p><div><ul><li>OUTPUT:</li></ul></div><p>
<table border=2>
<tr><td><b>new_data</b></td><td>retrieved data in MATLAB structure</td></tr>
<tr><td><b>dateMap</b></td><td>a hash map stores index file corresponding to the converted data</td></tr>
</table>
</p><h2>Code<a name="2"></a></h2><pre class="codeinput"><span class="keyword">function</span> [new_data, dateMap] = gatherData_byCam(camList, date, output_folder)
</pre><pre class="codeinput">disp(<span class="string">'Gathering data based on camera group...'</span>);
dateMap = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>,<span class="string">'ValueType'</span>,<span class="string">'any'</span>);
    camMap = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>,<span class="string">'ValueType'</span>,<span class="string">'any'</span>);
    data_list = cell(length(camList),1);
</pre><p>As the data is sorted by the camera group and then be stored in the whole dataset, for each camera group, there are two indexes, one indicates the starting position in the whole data set, and another one indicates the ending position in the whole data set. This can help to quick access for further usage.</p><pre class="codeinput">    idxS = 0;
    <span class="keyword">for</span> id=1:length(camList);
        camName = camList{id};
        file = [output_folder <span class="string">'\'</span> camName <span class="string">'\'</span> str2date(date) <span class="string">'.csv'</span>];
        tmpdata = load_ANPR_data_csv(file, <span class="string">'all'</span>, 9);
        <span class="keyword">if</span> ~isempty(tmpdata)
            data = sortrows(tmpdata,3);
            data_list{id} = data;
            idxS = idxS + 1;
            lenD = length(data);
            idxE = idxS + lenD;
            val_tmp = {idxS, idxE};
            camMap(camName) = val_tmp;
            idxS = idxE;
            clear <span class="string">val_tmp</span>;
        <span class="keyword">end</span>

    <span class="keyword">end</span>
    dateMap(str2date(date)) = camMap;
clear <span class="string">idx</span>;
clear <span class="string">id</span>;

tmp_data = data_list{1};
<span class="keyword">for</span> id=2:length(data_list)
    tmp_data = [tmp_data; data_list{id}];
<span class="keyword">end</span>
new_data = tmp_data;
</pre><h2>Navigation<a name="5"></a></h2><div><ul><li>Go to <a href="..\html\main.html">main</a></li><li>Go to <a href="http://www.surrey.ac.uk/cs/research/msf/projects/polarbear_pattern_of_life_anpr_behaviour_extraction_analysis_and_recognition.htm">Project page</a></li></ul></div><h2>Author<a name="6"></a></h2><pre>Haiyue Yuan, 02.2016, Depatment of Computer Science, University of Surrey</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Retrieve Data by Camera Group
% This script is to gather data based on the camera groups and dates, and then convert the data to matlab data structure (new_data). In the mean time, it keeps the information of how the data stores in the matlab data structure (dateMap) in order to quick access in a later stage.

%%
%% I/O
% * INPUT:
%
% <html>
% <table border=2>
% <tr><td><b>date</b></td><td>the request date for conversion</td></tr>
% <tr><td><b>output_folder</b></td><td>the path to store the converted ANPR data, and intermediate data</td></tr>
% <tr><td><b>camList</b></td><td>is used to organise data by camera group</td></tr>
% </table>
% </html>
%
% * OUTPUT:
%
% <html>
% <table border=2>
% <tr><td><b>new_data</b></td><td>retrieved data in MATLAB structure</td></tr>
% <tr><td><b>dateMap</b></td><td>a hash map stores index file corresponding to the converted data</td></tr>
% </table>
% </html>
%
%% Code

function [new_data, dateMap] = gatherData_byCam(camList, date, output_folder)
disp('Gathering data based on camera group...');
dateMap = containers.Map('KeyType','char','ValueType','any');
    camMap = containers.Map('KeyType','char','ValueType','any');
    data_list = cell(length(camList),1);
    %%
    % As the data is sorted by the camera group and then be stored in the
    % whole dataset, for each camera group, there are two indexes, one indicates the
    % starting position in the whole data set, and another one indicates
    % the ending position in the whole data set. This can help to quick
    % access for further usage.
    idxS = 0;
    for id=1:length(camList);
        camName = camList{id};
        file = [output_folder '\' camName '\' str2date(date) '.csv'];
        tmpdata = load_ANPR_data_csv(file, 'all', 9);
        if ~isempty(tmpdata)
            data = sortrows(tmpdata,3);
            data_list{id} = data;
            idxS = idxS + 1;
            lenD = length(data);
            idxE = idxS + lenD;
            val_tmp = {idxS, idxE};
            camMap(camName) = val_tmp;
            idxS = idxE;
            clear val_tmp;
        end
        
    end
    dateMap(str2date(date)) = camMap;
clear idx;
clear id;

tmp_data = data_list{1};
for id=2:length(data_list)
    tmp_data = [tmp_data; data_list{id}];
end
new_data = tmp_data;

%% Navigation
% * Go to 
% <..\html\main.html main> 
% * Go to 
% <http://www.surrey.ac.uk/cs/research/msf/projects/polarbear_pattern_of_life_anpr_behaviour_extraction_analysis_and_recognition.htm Project page> 

%% Author
%  Haiyue Yuan, 02.2016, Depatment of Computer Science, University of Surrey




##### SOURCE END #####
--></body></html>